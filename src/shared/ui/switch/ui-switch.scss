.ui-switch {
  cursor: pointer;
  position: relative;

  display: flex;
  flex-shrink: 0;
  gap: 24px;
  align-items: center;
  justify-content: space-between;

  @media #{media('<', d)} {
    gap: 12px;
  }

  @media #{media('>', d)} and (hover: hover) and (pointer: fine) {
    &:hover {
      input:not(:checked) ~ .ui-switch__toggler {
        border-color: #000000;

        .ui-switch__slider {
          background-color: #000000;
        }
      }
    }
  }

  // ключевая идея: left всегда 5px; на финише едем transform’ом
  @keyframes switch {
    0% {
      left: 5px;
      width: 22px;
      transform: translateY(-50%) translateX(0);
    }
    50% {
      left: 5px;
      width: 54px; // «растяжка» посередине
      transform: translateY(-50%) translateX(0);
    }
    100% {
      left: 5px;
      width: 22px;
      transform: translateY(-50%) translateX(var(--travel-transform)); // переезд вправо без layout
    }
  }

  @keyframes switch-back {
    0% {
      left: 5px;
      width: 22px;
      transform: translateY(-50%) translateX(var(--travel-transform)); // старт справа
    }
    50% {
      left: 5px;
      width: 54px;
      transform: translateY(-50%) translateX(0);
    }
    100% {
      left: 5px;
      width: 22px;
      transform: translateY(-50%) translateX(0); // финиш слева
    }
  }

  &:has(input:disabled) {
    pointer-events: none;
    cursor: auto;
    opacity: 0.4;
  }

  // Глобальный transition можно оставить — бегунок переопределим ниже
  * { transition: $transition; }

  &__text { @include cropText(2); }

  &__toggler {
    position: relative;
    display: block;
    flex-shrink: 0;

    width: 64px;
    height: 32px;
    padding: 5px;
    border: 1px solid;
    border-radius: 32px;

    border-color: #e4e4e4;

    // Изоляция, чтобы перерасчёты внутри не пинали соседей
    contain: layout paint style;
    isolation: isolate;

    // геометрия
    --pad: 5px;
    --knob: 22px; // важно: используем те же 22px, что и в keyframes
    --wide: 54px;
    // Смещение центра при transform для финиша справа:
    // левый край 5px -> правый стоп 37px => сдвиг 32px
    --travel-transform: 32px;
  }

  &__slider {
    position: absolute;
    top: 50%;
    left: 5px;                // фиксируем left навсегда
    right: auto;
    transform: translateY(-50%) translateX(0);
    transform-origin: center;

    display: block;

    width: 22px;              // синхроним с keyframes
    height: 22px;
    border-radius: 22px;
    background-color: #e4e4e4;

    // НЕ транзишним left/width, ими управляют keyframes.
    // Даем слою стабильность для Firefox:
    transition:
      background-color 180ms ease,
      box-shadow 180ms ease;
    will-change: width, transform;
    backface-visibility: hidden;
    translate: 0;             // заводим отдельный композитный трек
  }

  @media (prefers-reduced-motion: reduce) {
    &__slider {
      animation: none !important;
      transition: none;
    }
  }

  input {
    pointer-events: none;

    position: absolute;
    z-index: -1;
    top: 0;
    left: 0;

    width: 0;
    height: 0;

    opacity: 0;
  }

  // Состояния
  input:checked ~ .ui-switch__toggler {
    border-color: #000000;

    .ui-switch__slider {
      animation: switch 0.5s cubic-bezier(0.33, 1, 0.68, 1) both;
      background-color: #000000;
    }
  }

  input:not(:checked) ~ .ui-switch__toggler {
    .ui-switch__slider {
      animation: switch-back 0.5s cubic-bezier(0.33, 1, 0.68, 1) both;
    }
  }

  // По желанию: лёгкий отклик, не влияет на конечную позицию
  &:active .ui-switch__slider {
    animation-duration: 420ms;
  }
}
